<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Offline Game - Tic Tac Toe</title>
    
    <link rel="manifest" href="./manifest.json">
    
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        /* Dasar & Reset */
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; /* Hilangkan kedipan biru saat klik di HP */
            outline: none;
        }
        
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0f172a;
            font-family: 'Segoe UI', sans-serif;
            color: #fff;
            /* Support untuk area aman (Notch/Baterai) */
            padding-top: env(safe-area-inset-top);
        }

        /* Container Utama */
        #main-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        h1 { font-size: 24px; color: #38bdf8; margin: 0 0 10px 0; pointer-events: none; }
        
        .menu { margin-bottom: 20px; pointer-events: auto; }
        select { 
            padding: 8px; border-radius: 5px; background: #1e293b; 
            color: white; border: 1px solid #38bdf8; cursor: pointer; 
        }

        /* Board Game */
        .board { 
            display: grid; 
            grid-template-columns: repeat(3, 85px); 
            grid-template-rows: repeat(3, 85px); 
            gap: 10px; 
            background: #1e293b; 
            padding: 15px; 
            border-radius: 15px; 
            position: relative;
            pointer-events: auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .cell { 
            background: #334155; border-radius: 10px; display: flex; align-items: center; 
            justify-content: center; font-size: 35px; font-weight: bold; cursor: pointer;
            transition: background 0.2s;
        }
        .cell:active { background: #475569; }
        .cell.x-color { color: #38bdf8; }
        .cell.o-color { color: #fb7185; }

        #winning-line {
            position: absolute; background: #f43f5e; display: none; z-index: 10;
            border-radius: 10px; box-shadow: 0 0 15px #f43f5e;
            pointer-events: none;
        }

        .status { margin-top: 15px; font-size: 16px; color: #94a3b8; height: 20px; pointer-events: none; }
        
        .btn-group { margin-top: 20px; display: flex; gap: 10px; pointer-events: auto; }
        button { padding: 10px 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-reset { background: #334155; color: white; }
        .btn-online { background: #0ea5e9; color: white; }

        .hint {
            position: absolute; bottom: 15px; font-size: 11px; color: #475569;
            pointer-events: none;
        }
    </style>
</head>
<body onclick="handleScreenClick(event)">

    <div id="main-container">
        <h1>TIC TAC TOE</h1>
        
        <div class="menu">
            <label>Level: </label>
            <select id="difficulty" onchange="resetGame()">
                <option value="easy" selected>Mudah</option>
                <option value="medium">Sedang</option>
                <option value="hard">Sulit</option>
                <option value="impossible">Mustahil ðŸ˜‚</option>
            </select>
        </div>

        <div class="board" id="board" onclick="event.stopPropagation()">
            <div id="winning-line"></div>
            <div class="cell" onclick="makeMove(0)"></div>
            <div class="cell" onclick="makeMove(1)"></div>
            <div class="cell" onclick="makeMove(2)"></div>
            <div class="cell" onclick="makeMove(3)"></div>
            <div class="cell" onclick="makeMove(4)"></div>
            <div class="cell" onclick="makeMove(5)"></div>
            <div class="cell" onclick="makeMove(6)"></div>
            <div class="cell" onclick="makeMove(7)"></div>
            <div class="cell" onclick="makeMove(8)"></div>
        </div>

        <div class="status" id="status">Giliran Kamu</div>
        
        <div class="btn-group" onclick="event.stopPropagation()">
            <button class="btn-reset" onclick="resetGame()">Ulang</button>
            <button class="btn-online" onclick="window.location.reload()">Cek Koneksi</button>
        </div>

        <div class="hint">Sentuh area kosong untuk Layar Penuh</div>
    </div>

    <script>
        /* --- LOGIKA FULLSCREEN (ANTI-KEDIP) --- */
        function handleScreenClick(e) {
            const isFullscreen = document.fullscreenElement || 
                                 document.webkitFullscreenElement || 
                                 document.msFullscreenElement;

            if (!isFullscreen) {
                let elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            }
        }

        /* --- LOGIKA GAME ASLI ANDA (TIDAK DIHAPUS) --- */
        let board = ["", "", "", "", "", "", "", "", ""];
        let huPlayer = "X";
        let aiPlayer = "O";
        let gameActive = true;

        const winConditions = [[0,1,2], [3,4,5], [6,7,8], [0,3,6], [1,4,7], [2,5,8], [0,4,8], [2,4,6]];
        const lineStyles = [[50,15,280,6,0], [152,15,280,6,0], [254,15,280,6,0], [15,50,6,280,0], [15,152,6,280,0], [15,254,6,280,0], [25,25,370,6,45], [25,285,370,6,135]];

        function makeMove(idx) {
            if (board[idx] === "" && gameActive) {
                board[idx] = huPlayer;
                updateDisplay();
                if (!checkWin(board, huPlayer) && !checkTie()) {
                    setTimeout(aiMove, 400);
                } else { checkGameStatus(); }
            }
        }

        function aiMove() {
            const diff = document.getElementById('difficulty').value;
            let move;
            let rand = Math.random();

            if (diff === "easy") {
                move = randomMove();
            } else if (diff === "medium") {
                move = (rand < 0.5) ? minimax(board, aiPlayer).index : randomMove();
            } else if (diff === "hard") {
                move = (rand < 0.9) ? minimax(board, aiPlayer).index : randomMove();
            } else {
                move = minimax(board, aiPlayer).index;
            }

            board[move] = aiPlayer;
            updateDisplay();
            checkGameStatus();
        }

        function randomMove() {
            let avail = board.map((v, i) => v === "" ? i : null).filter(v => v !== null);
            return avail[Math.floor(Math.random() * avail.length)];
        }

        function minimax(newBoard, player) {
            let availSpots = newBoard.map((v, i) => v === "" ? i : null).filter(v => v !== null);
            if (checkWin(newBoard, huPlayer)) return {score: -10};
            if (checkWin(newBoard, aiPlayer)) return {score: 10};
            if (availSpots.length === 0) return {score: 0};

            let moves = [];
            for (let i = 0; i < availSpots.length; i++) {
                let move = {};
                move.index = availSpots[i];
                newBoard[availSpots[i]] = player;
                if (player === aiPlayer) move.score = minimax(newBoard, huPlayer).score;
                else move.score = minimax(newBoard, aiPlayer).score;
                newBoard[availSpots[i]] = "";
                moves.push(move);
            }

            let bestMove;
            if (player === aiPlayer) {
                let bestScore = -Infinity;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score > bestScore) { bestScore = moves[i].score; bestMove = i; }
                }
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score < bestScore) { bestScore = moves[i].score; bestMove = i; }
                }
            }
            return moves[bestMove];
        }

        function checkWin(b, p) {
            for (let i = 0; i < winConditions.length; i++) {
                if (b[winConditions[i][0]] === p && b[winConditions[i][1]] === p && b[winConditions[i][2]] === p) return {index: i, player: p};
            }
            return null;
        }

        function checkTie() { return board.filter(s => s === "").length === 0; }

        function checkGameStatus() {
            let win = checkWin(board, huPlayer) || checkWin(board, aiPlayer);
            if (win) {
                document.getElementById('status').innerText = win.player === "X" ? "Kamu Menang!" : "Komputer Menang!";
                const line = document.getElementById('winning-line');
                const [top, left, w, h, deg] = lineStyles[win.index];
                line.style.top = top+"px"; line.style.left = left+"px"; line.style.width = w+"px"; line.style.height = h+"px";
                line.style.transform = `rotate(${deg}deg)`; line.style.transformOrigin = "top left"; line.style.display = "block";
                gameActive = false;
            } else if (checkTie()) {
                document.getElementById('status').innerText = "Seri!";
                gameActive = false;
            }
        }

        function updateDisplay() {
            const cells = document.querySelectorAll('.cell');
            board.forEach((val, i) => {
                cells[i].innerText = val;
                cells[i].className = val === "X" ? "cell x-color" : (val === "O" ? "cell o-color" : "cell");
            });
        }

        function resetGame() {
            board = ["", "", "", "", "", "", "", "", ""];
            gameActive = true;
            document.getElementById('winning-line').style.display = "none";
            document.getElementById('status').innerText = "Giliran Kamu";
            updateDisplay();
        }
    </script>
</body>
</html>
